<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>github.com/RhysU/helm: helm.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">github.com/RhysU/helm
   </div>
   <div id="projectbrief">A header-only PID controller.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('helm_8h.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">helm.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A header-only PID controller based largely on <a href="http://www.cds.caltech.edu/~murray/amwiki/index.php/PID_Control">Chapter 10</a> of <a href="http://www.worldcat.org/isbn/0691135762">Astrom and Murray</a>.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structhelm__state"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="helm_8h.html#structhelm__state">helm_state</a></td></tr>
<tr class="memdesc:structhelm__state"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tuning parameters and internal state for an incremental PID controller.  <a href="helm_8h.html#structhelm__state">More...</a><br/></td></tr>
<tr class="separator:structhelm__state"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa1ca3d5b8d7f57a2273b082dcf616a5c"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="helm_8h.html#structhelm__state">helm_state</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="helm_8h.html#aa1ca3d5b8d7f57a2273b082dcf616a5c">helm_reset</a> (struct <a class="el" href="helm_8h.html#structhelm__state">helm_state</a> *const h)</td></tr>
<tr class="memdesc:aa1ca3d5b8d7f57a2273b082dcf616a5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset all tuning parameters, but <em>not</em> transient state.  <a href="#aa1ca3d5b8d7f57a2273b082dcf616a5c">More...</a><br/></td></tr>
<tr class="separator:aa1ca3d5b8d7f57a2273b082dcf616a5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff702bbf25457cec5b3b040ddc07aac4"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="helm_8h.html#structhelm__state">helm_state</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="helm_8h.html#aff702bbf25457cec5b3b040ddc07aac4">helm_approach</a> (struct <a class="el" href="helm_8h.html#structhelm__state">helm_state</a> *const h)</td></tr>
<tr class="memdesc:aff702bbf25457cec5b3b040ddc07aac4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset any transient state, but <em>not</em> tuning parameters.  <a href="#aff702bbf25457cec5b3b040ddc07aac4">More...</a><br/></td></tr>
<tr class="separator:aff702bbf25457cec5b3b040ddc07aac4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7875349b12753d0028ff0906b3ba6826"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="helm_8h.html#a7875349b12753d0028ff0906b3ba6826">helm_steady</a> (struct <a class="el" href="helm_8h.html#structhelm__state">helm_state</a> *const h, const double dt, const double r, const double u, const double v, const double y)</td></tr>
<tr class="memdesc:a7875349b12753d0028ff0906b3ba6826"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the control signal necessary to steady unsteady process y(t).  <a href="#a7875349b12753d0028ff0906b3ba6826">More...</a><br/></td></tr>
<tr class="separator:a7875349b12753d0028ff0906b3ba6826"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A header-only PID controller based largely on <a href="http://www.cds.caltech.edu/~murray/amwiki/index.php/PID_Control">Chapter 10</a> of <a href="http://www.worldcat.org/isbn/0691135762">Astrom and Murray</a>. </p>
<p>This proportional-integral-derivative (PID) controller features </p>
<ul>
<li>
low pass filtering of the process derivative, </li>
<li>
windup protection, </li>
<li>
automatic reset on actuator saturation, </li>
<li>
anti-kick on setpoint change using "derivative on measurement", </li>
<li>
incremental output for bumpless manual-to-automatic transitions, </li>
<li>
a unified controller gain parameter, </li>
<li>
exposure of all independent physical time scales, and </li>
<li>
the ability to accommodate varying sample rate. </li>
</ul>
<div class="image">
<img src="helm.png" alt="helm.png"/>
<div class="caption">
Block diagram for the controller</div></div>
<p>Let \(f\) be a first-order, low-pass filtered version of controlled process output \(y\) governed by </p>
<p class="formulaDsp">
\begin{align} \frac{\mathrm{d}}{\mathrm{d}t} f &amp;= \frac{y - f}{T_f} \end{align}
</p>
<p> where \(T_f\) is a filter time scale. Then, in the time domain and expressed in positional form, the control signal \(v\) evolves according to </p>
<p class="formulaDsp">
\begin{align} v(t) &amp;= k_p \, e(t) + k_i \int_0^t e(t) \,\mathrm{d}t + k_t \int_0^t e_s(t) \,\mathrm{d}t - k_d \frac{\mathrm{d}}{\mathrm{d}t} f(t) \\ &amp;= k_p \left[ e(t) + \frac{1}{T_i} \int_0^t e(t) \,\mathrm{d}t + \frac{1}{T_t} \int_0^t e_s(t) \,\mathrm{d}t - T_d \frac{\mathrm{d}}{\mathrm{d}t} f(t) \right] \\ &amp;= k_p \left[ \left(r(t) - y(t)\right) + \frac{1}{T_i} \int_0^t \left(r(t) - y(t)\right) \,\mathrm{d}t + \frac{1}{T_t} \int_0^t \left(u(t) - v(t)\right) \,\mathrm{d}t + \frac{T_d}{T_f}\left(f(t) - y(t)\right) \right] \end{align}
</p>
<p> where \(u\) is the actuator position and \(r\) is the desired reference or "setpoint" value. Constants \(T_i\), \(T_t\), and \(T_d\) are the integral, automatic reset, and derivative time scales while \(k_p\) specifies the unified gain. Differentiating one finds the "incremental" form written for continuous time, </p>
<p class="formulaDsp">
\begin{align} \frac{\mathrm{d}}{\mathrm{d}t} v(t) &amp;= k_p \left[ - \frac{\mathrm{d}}{\mathrm{d}t} y(t) + \frac{r(t) - y(t)}{T_i} + \frac{u(t) - v(t)}{T_t} + \frac{T_d}{T_f}\left( \frac{\mathrm{d}}{\mathrm{d}t} f(t) - \frac{\mathrm{d}}{\mathrm{d}t} y(t) \right) \right] . \end{align}
</p>
<p> Here, to avoid controller kick on instantaneous reference value changes, we assume \(\frac{\mathrm{d}}{\mathrm{d}t} r(t) = 0\). This assumption is sometimes called "derivative on measurement" in reference to neglecting the non-measured portion of the error derivative \(\frac{\mathrm{d}}{\mathrm{d}t} e(t)\).</p>
<p>Obtaining a discrete time evoluation equation is straightforward. Multiply the above continuous result by the time differential, substitute first order backward differences, and incorporate the low-pass filter in a consistent fashion. One then finds the following: </p>
<p class="formulaDsp">
\begin{align} {\mathrm{d}t}_i &amp;= t_i - t_{i-1} \end{align}
</p>
 <p class="formulaDsp">
\begin{align} f(t_i) &amp;= \frac{ {\mathrm{d}t}_i\,y(t_i) + T_f\,f(t_{i-1}) } { T_f + {\mathrm{d}t}_i } = \alpha y(t_i) + (1 - \alpha) f_{i-1} \quad\text{with } \alpha=\frac{{\mathrm{d}t}_i}{T_f + {\mathrm{d}t}_i} \end{align}
</p>
 <p class="formulaDsp">
\begin{align} {\mathrm{d}f}_i &amp;= f(t_i) - f(t_{i-1}) = \alpha\left( y(t_i) - f(t_{i-1}) \right) \end{align}
</p>
 <p class="formulaDsp">
\begin{align} {\mathrm{d}y}_i &amp;= y(t_i) - y(t_{i-1}) \end{align}
</p>
 <p class="formulaDsp">
\begin{align} {\mathrm{d}v}_i &amp;= k_p \left[ {\mathrm{d}t}_i \left( \frac{r(t_i) - y(t_i)}{T_i} + \frac{u(t_i) - v(t_i)}{T_t} \right) + \frac{T_d}{T_f}\left( {\mathrm{d}f}_i - {\mathrm{d}y}_i \right) - {\mathrm{d}y}_i \right] \end{align}
</p>
<p> where notice \(f(t)\) is nothing but an exponential weighted moving average of \(y(t)\) that permits varying the sampling rate. An implementation needs only to track two pieces of state, namely \(f(t_{i-1})\) and \(y(t_{i-1})\), across time steps.</p>
<p>Sample written with nomenclature from <a class="el" href="helm_8h.html#structhelm__state" title="Tuning parameters and internal state for an incremental PID controller. ">helm_state</a> and <a class="el" href="helm_8h.html#a7875349b12753d0028ff0906b3ba6826" title="Find the control signal necessary to steady unsteady process y(t). ">helm_steady()</a>: </p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="helm_8h.html#structhelm__state" title="Tuning parameters and internal state for an incremental PID controller. ">helm_state</a> h;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set PID parameters from commonly given \c kp, \c ki, \c kt, and \c kd</span></div>
<div class="line"><a class="code" href="helm_8h.html#aa1ca3d5b8d7f57a2273b082dcf616a5c" title="Reset all tuning parameters, but not transient state. ">helm_reset</a>(&amp;h);</div>
<div class="line">h.kp = <a class="code" href="helm_8h.html#a32d85aaf6ac0b3df94f2b97ca73c00bb" title="Proportional gain modifying P, I, and D terms. ">kp</a>;</div>
<div class="line">h.Td = kd / h.kp;</div>
<div class="line">h.Tf = h.Td / 10;  <span class="comment">// Astrom and Murray p.308 suggests 2--20</span></div>
<div class="line">h.Ti = h.kp / ki;</div>
<div class="line">h.Tt = h.kp / kt;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Enable automatic control and evolve</span></div>
<div class="line"><a class="code" href="helm_8h.html#aff702bbf25457cec5b3b040ddc07aac4" title="Reset any transient state, but not tuning parameters. ">helm_approach</a>(&amp;h);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; N; ++i) {</div>
<div class="line">   <a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>  = process(dt, u);</div>
<div class="line">   v += <a class="code" href="helm_8h.html#a7875349b12753d0028ff0906b3ba6826" title="Find the control signal necessary to steady unsteady process y(t). ">helm_steady</a>(&amp;h, dt, r, u, v, <a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>);</div>
<div class="line">   u  = actuate(dt, v);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Disable controller and evolve</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; N; ++i) {  <span class="comment">// E</span></div>
<div class="line">   <a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>  = process(dt, u);</div>
<div class="line">   u  = actuate(dt, v);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Re-enable automatic control and evolve</span></div>
<div class="line"><a class="code" href="helm_8h.html#aff702bbf25457cec5b3b040ddc07aac4" title="Reset any transient state, but not tuning parameters. ">helm_approach</a>(&amp;h);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; N; ++i) {</div>
<div class="line">   <a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>  = process(dt, u);</div>
<div class="line">   v += <a class="code" href="helm_8h.html#a7875349b12753d0028ff0906b3ba6826" title="Find the control signal necessary to steady unsteady process y(t). ">helm_steady</a>(&amp;h, dt, r, u, v, <a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>);</div>
<div class="line">   u  = actuate(dt, v);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structhelm__state" id="structhelm__state"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct helm_state</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Tuning parameters and internal state for an incremental PID controller. </p>
<p>Gain <a class="el" href="helm_8h.html#a32d85aaf6ac0b3df94f2b97ca73c00bb" title="Proportional gain modifying P, I, and D terms. ">kp</a> has units of \(u_0 / y_0\) where \(u_0\) and \(y_0\) are the natural actuator and process observable signals, respectively. Parameter <a class="el" href="helm_8h.html#af5465d1d83ae53bd46f0b63436be402e" title="Time scale governing automatic reset. ">Tt</a> has units of time multiplied by \(u_0 / y_0\). Parameters <a class="el" href="helm_8h.html#ade329ce07a5121e4e1ddbc6656d6dbe4" title="Time scale governing derivative action. ">Td</a>, <a class="el" href="helm_8h.html#aa485866b4779b71755b3413acd308550" title="Time scale filtering process observable for D. ">Tf</a>, and <a class="el" href="helm_8h.html#a30ad71a64f9e17324ffb79c7a528f23c" title="Time scale governing integral action. ">Ti</a> possess units of time. Time units are fixed by the scaling provided in the <code>dt</code> argument to <a class="el" href="helm_8h.html#a7875349b12753d0028ff0906b3ba6826" title="Find the control signal necessary to steady unsteady process y(t). ">helm_steady()</a>. </p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a32d85aaf6ac0b3df94f2b97ca73c00bb"></a>double</td>
<td class="fieldname">
kp</td>
<td class="fielddoc">
Proportional gain modifying P, I, and D terms. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ade329ce07a5121e4e1ddbc6656d6dbe4"></a>double</td>
<td class="fieldname">
Td</td>
<td class="fielddoc">
Time scale governing derivative action. <p>Set to zero to disable derivative control. </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="aa485866b4779b71755b3413acd308550"></a>double</td>
<td class="fieldname">
Tf</td>
<td class="fielddoc">
Time scale filtering process observable for D. <p>Set to infinity to disable observable filtering. </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a30ad71a64f9e17324ffb79c7a528f23c"></a>double</td>
<td class="fieldname">
Ti</td>
<td class="fielddoc">
Time scale governing integral action. <p>Set to infinity to disable integral control. </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="af5465d1d83ae53bd46f0b63436be402e"></a>double</td>
<td class="fieldname">
Tt</td>
<td class="fielddoc">
Time scale governing automatic reset. <p>Set to infinity to disable automatic reset. </p>
</td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="ab04bb7ebc1a12333d1c020880459259a"></a>double</td>
<td class="fieldname">
y</td>
<td class="fielddoc">
Internal tracking of the process observable. </td></tr>
<tr><td class="fieldtype">
<a class="anchor" id="a6a4871b565f2ed46bd43e5fadf9d5961"></a>double</td>
<td class="fieldname">
f</td>
<td class="fielddoc">
Internal tracking the filtered process. </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aa1ca3d5b8d7f57a2273b082dcf616a5c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="helm_8h.html#structhelm__state">helm_state</a>* helm_reset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="helm_8h.html#structhelm__state">helm_state</a> *const&#160;</td>
          <td class="paramname"><em>h</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reset all tuning parameters, but <em>not</em> transient state. </p>
<p>Resets gain to one and disables filtering, integral action, and derivative action. Enable those terms by setting their associated time scales.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Houses tuning parameters to be reset. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Argument <code>h</code> to permit call chaining. </dd></dl>
<div class="fragment"><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;{</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    h-&gt;<a class="code" href="helm_8h.html#a32d85aaf6ac0b3df94f2b97ca73c00bb" title="Proportional gain modifying P, I, and D terms. ">kp</a> = 1;        <span class="comment">// Unit gain</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    h-&gt;<a class="code" href="helm_8h.html#ade329ce07a5121e4e1ddbc6656d6dbe4" title="Time scale governing derivative action. ">Td</a> = 0;        <span class="comment">// No derivative action</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    h-&gt;<a class="code" href="helm_8h.html#aa485866b4779b71755b3413acd308550" title="Time scale filtering process observable for D. ">Tf</a> = INFINITY; <span class="comment">// No filtering</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    h-&gt;<a class="code" href="helm_8h.html#a30ad71a64f9e17324ffb79c7a528f23c" title="Time scale governing integral action. ">Ti</a> = INFINITY; <span class="comment">// No integral action</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    h-&gt;<a class="code" href="helm_8h.html#af5465d1d83ae53bd46f0b63436be402e" title="Time scale governing automatic reset. ">Tt</a> = INFINITY; <span class="comment">// No automatic reset</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">return</span> h;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aff702bbf25457cec5b3b040ddc07aac4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="helm_8h.html#structhelm__state">helm_state</a>* helm_approach </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="helm_8h.html#structhelm__state">helm_state</a> *const&#160;</td>
          <td class="paramname"><em>h</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reset any transient state, but <em>not</em> tuning parameters. </p>
<p>Necessary to achieve bumpless manual-to-automatic transitions before calling to <a class="el" href="helm_8h.html#a7875349b12753d0028ff0906b3ba6826" title="Find the control signal necessary to steady unsteady process y(t). ">helm_steady()</a> after a period of manual control, including <em>before</em> the first call to <a class="el" href="helm_8h.html#a7875349b12753d0028ff0906b3ba6826" title="Find the control signal necessary to steady unsteady process y(t). ">helm_steady()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Houses transient state to be reset. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Argument <code>h</code> to permit call chaining. </dd></dl>
<div class="fragment"><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;{</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    assert(h-&gt;<a class="code" href="helm_8h.html#ade329ce07a5121e4e1ddbc6656d6dbe4" title="Time scale governing derivative action. ">Td</a> &gt;= 0);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    assert(h-&gt;<a class="code" href="helm_8h.html#aa485866b4779b71755b3413acd308550" title="Time scale filtering process observable for D. ">Tf</a> &gt;  0);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    assert(h-&gt;<a class="code" href="helm_8h.html#a30ad71a64f9e17324ffb79c7a528f23c" title="Time scale governing integral action. ">Ti</a> &gt;  0);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    assert(h-&gt;<a class="code" href="helm_8h.html#af5465d1d83ae53bd46f0b63436be402e" title="Time scale governing automatic reset. ">Tt</a> &gt;  0);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    h-&gt;<a class="code" href="helm_8h.html#a6a4871b565f2ed46bd43e5fadf9d5961" title="Internal tracking the filtered process. ">f</a> = NAN;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">return</span> h;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7875349b12753d0028ff0906b3ba6826"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double helm_steady </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="helm_8h.html#structhelm__state">helm_state</a> *const&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>y</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Find the control signal necessary to steady unsteady process y(t). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Tuning parameters and state maintained across invocations. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>Time since last samples collected. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">r</td><td>Reference value, often called the "setpoint". </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u</td><td>Actuator signal currently observed. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>Actuator signal currently requested. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">y</td><td>Observed process output to drive to <code>r</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Incremental suggested change to control signal <code>v</code>. </dd></dl>
<dl class="section see"><dt>See Also</dt><dd>Overview of <a class="el" href="helm_8h.html">helm.h</a> for the discrete evolution equations. </dd></dl>
<div class="fragment"><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;{</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordtype">double</span> dv = 0;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (!isnan(<a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>)) {                      <span class="comment">// Avoid driving blind</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">if</span> (isnan(h-&gt;<a class="code" href="helm_8h.html#a6a4871b565f2ed46bd43e5fadf9d5961" title="Internal tracking the filtered process. ">f</a>)) {                <span class="comment">// Avoid startup kick</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            h-&gt;<a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a> = <a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            h-&gt;<a class="code" href="helm_8h.html#a6a4871b565f2ed46bd43e5fadf9d5961" title="Internal tracking the filtered process. ">f</a> = <a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordtype">double</span> a, df, dy;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        a   = dt / (h-&gt;<a class="code" href="helm_8h.html#aa485866b4779b71755b3413acd308550" title="Time scale filtering process observable for D. ">Tf</a> + dt);          <span class="comment">// Convex combination parameter alpha</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        df  = a*(<a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a> - h-&gt;<a class="code" href="helm_8h.html#a6a4871b565f2ed46bd43e5fadf9d5961" title="Internal tracking the filtered process. ">f</a>);               <span class="comment">// Filtered difference for y</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        dy  =    <a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a> - h-&gt;<a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a> ;               <span class="comment">// Backward difference for y</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        dv += (r - <a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>) / h-&gt;<a class="code" href="helm_8h.html#a30ad71a64f9e17324ffb79c7a528f23c" title="Time scale governing integral action. ">Ti</a>;            <span class="comment">// Action from integral control</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        dv += (u - v) / h-&gt;<a class="code" href="helm_8h.html#af5465d1d83ae53bd46f0b63436be402e" title="Time scale governing automatic reset. ">Tt</a>;            <span class="comment">// Action from automatic reset</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        dv *= dt;                         <span class="comment">// Scale integral actions by time step</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        dv += (h-&gt;<a class="code" href="helm_8h.html#ade329ce07a5121e4e1ddbc6656d6dbe4" title="Time scale governing derivative action. ">Td</a> / h-&gt;<a class="code" href="helm_8h.html#aa485866b4779b71755b3413acd308550" title="Time scale filtering process observable for D. ">Tf</a>)*(df - dy);  <span class="comment">// Action from derivative control</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        dv += <span class="comment">/*dr=0*/</span> - dy;              <span class="comment">// Action from proporational control</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        dv *= h-&gt;<a class="code" href="helm_8h.html#a32d85aaf6ac0b3df94f2b97ca73c00bb" title="Proportional gain modifying P, I, and D terms. ">kp</a>;                      <span class="comment">// Scale by unified gain parameter</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        h-&gt;<a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>  = <a class="code" href="helm_8h.html#ab04bb7ebc1a12333d1c020880459259a" title="Internal tracking of the process observable. ">y</a>;                        <span class="comment">// Update observable for next call</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        h-&gt;<a class="code" href="helm_8h.html#a6a4871b565f2ed46bd43e5fadf9d5961" title="Internal tracking the filtered process. ">f</a> += df;                       <span class="comment">// Update filter for next call</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">return</span> dv;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="helm_8h.html">helm.h</a></li>
    <li class="footer">Generated on Mon Mar 17 2014 00:20:36 for github.com/RhysU/helm by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
